---
title: java内存模型介绍
tags: java,读书笔记
---


#### 关于java内存模型的定义

先看<<深入了解java虚拟机>>里对java内存模型的解释:

* java内存模型是由jvm规范定义的用来屏蔽掉java程序在各种不同的硬件和操作系统对内存的访问的差异.这样就可以实现java程序在各种不同的平台上都能达到内存访问的一致性.

按照我的理解,就是java虚拟机在操作系统之上封装了一套自己的内存管理机制.在jvm中,所有对底层内存的操作都要通过这套机制间接的执行.

这样做有什么好处呢?

举个例子,windows内存底层是分页机制.32位操作系统下每个进程有属于自己的4G虚拟空间.

但是我们基于java在windows下编程的时候从来不用考虑如何分配释放内存之类的问题.因为这些事情全部由jvm代劳了.

这就是统一内存管理的好处:方便由虚拟机进行自动化的内存管理.

#### java内存模型的结构


根据 JVM 规范，JVM 内存共分为`虚拟机栈`、`堆`、`方法区`、`程序计数器`、`本地方法栈`五个部分.

![](https://gitee.com/minagamiyuki/picgo-gitee/raw/master/images/20200224171215.png)

###### 程序计数器(Program Counter Register)

可以看作是当前线程所执行的字节码文件（class）的行号指示器。

在虚拟机的世界中，字节码解释器就是通过改变计数器的值来选取下一条执行的字节码指令，实现分支、循环、跳转、异常处理、线程恢复.

###### JAVA虚拟机栈(Virtual Machine Stack)

与程序计数器一样，Java虚拟机栈（Java Virtual Machine Stacks）也是线程私有的，它的生命周期与线程相同。虚拟机栈描述的是Java方法执行的内存模型：每个方法被执行的时候都会同时创建一个栈帧（Stack Frame）用于存储局部变量表、操作栈、动态链接、方法出口等信息。每一个方法被调用直至执行完成的过程，就对应着一个栈帧在虚拟机栈中从入栈到出栈的过程.

###### 本地方法栈（Native Method Stacks）

功能与Java虚拟机栈相同。区别在于，本地方法栈为虚拟机使用到的native方法服务.

###### 堆内存(Heap)

![](https://gitee.com/minagamiyuki/picgo-gitee/raw/master/images/20200224171646.png)

堆是JVM内存占用最大，管理最复杂的一个区域,是线程共享的.

其唯一的用途就是存放对象实例：所有的对象实例及数组都在对上进行分配。

1.7后，字符串常量池从永久代中剥离出来，存放在堆中。

堆有自己进一步的内存分块划分，按照GC分代收集角度的划分请参见上图。

###### 方法区(Method Area)

是线程共享的,用来存储已被虚拟机加载的类信息、常量、静态变量、即时编译器编译后的代码等数据.




